(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-post-detail-post-detail"],{"1af1":function(t,e,i){"use strict";var n=i("4ea4");i("99af"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=n(i("2909")),a=n(i("e5a1")),o={filters:{formatTime:function(t){return a.default.getHumanTime(t)}},data:function(){return{detail:{id:0,content:[],user_id:0,comment_count:0,support_count:0,is_top:0,created_time:"",user:{id:0,avatar:"",sex:"未知",name:""},issupport:!1},page:1,comments:[],loadStatus:"more",commentForm:{reply_id:0,reply_user:null}}},onLoad:function(t){var e=this;if(!t.id)return this.$toast("非法参数"),uni.navigateBack({delta:1});this.detail.id=t.id,this.$api.readPost({id:t.id}).then((function(t){e.detail=t,console.log(e.detail)})),this.getCommentList()},methods:{sendComment:function(t){var e=this,i={post_id:this.detail.id,content:t,reply_id:0};this.commentForm.reply_user&&(i.reply_id=this.commentForm.reply_id,i.reply_user=this.commentForm.reply_user),this.$api.replyPost(i).then((function(t){e.$toast("评论成功"),e.page=1,e.getCommentList(),uni.$emit("refreshBbs")}))},openComment:function(t){t?(this.commentForm.reply_id=t.reply_id,this.commentForm.reply_user=t.reply_user,this.commentForm.reply_user.username=t.reply_user.name):this.commentForm={reply_id:0,reply_user:null},this.$refs.comment.open()},handleSupport:function(){var t=this,e=this.detail,i=e.issupport?"unsupportPost":"supportPost",n=e.issupport?"取消点赞":"点赞成功";this.$api[i]({post_id:e.id}).then((function(i){e.support_count=e.issupport?e.support_count-1:e.support_count+1,e.issupport=!e.issupport,t.$toast(n),uni.$emit("refreshBbs")}))},loadMore:function(){"more"==this.loadStatus&&(this.page=this.page+1,this.getCommentList())},getCommentList:function(){var t=this;this.loadStatus="loading",this.$api.getPostComments({post_id:this.detail.id,page:this.page}).then((function(e){var i=e.rows;t.comments=1==t.page?i:[].concat((0,s.default)(t.comments),(0,s.default)(i)),t.loadStatus=i.length<10?"noMore":"more",console.log(t.comments)})).catch((function(e){t.loadStatus="more",t.page>1&&(t.page=t.page-1)}))}}};e.default=o},"64da":function(t,e,i){var n=i("24fb");e=n(!1),e.push([t.i,".comment-list[data-v-04b80954]{display:flex;flex-wrap:nowrap;width:100%;padding:%?20?% 0}.comment-list .face[data-v-04b80954]{border-radius:100%;width:%?70?%;height:%?70?%;flex-shrink:0;margin-right:%?20?%;background-color:#eee}.comment-list .top[data-v-04b80954]{color:#007aff;font-size:%?24?%}.comment-list .content[data-v-04b80954]{padding:%?8?% 0}.comment-list .date[data-v-04b80954]{color:#666;font-size:%?24?%}",""]),t.exports=e},6940:function(t,e,i){"use strict";i.r(e);var n=i("be40"),s=i("98c3");for(var a in s)"default"!==a&&function(t){i.d(e,t,(function(){return s[t]}))}(a);i("6cc8");var o,c=i("f0c5"),r=Object(c["a"])(s["default"],n["b"],n["c"],!1,null,"04b80954",null,!1,n["a"],o);e["default"]=r.exports},"6cc8":function(t,e,i){"use strict";var n=i("d29c"),s=i.n(n);s.a},"6d57":function(t,e,i){"use strict";var n;i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return n}));var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("v-uni-view",{staticClass:"p-3"},[i("v-uni-view",{staticClass:"flex align-center w-100"},[i("v-uni-view",{staticClass:"flex align-center"},[i("v-uni-image",{staticClass:"mr-2 bg-light",staticStyle:{width:"75rpx",height:"75rpx","border-radius":"100%"},attrs:{src:t.item.user.avatar}}),i("v-uni-view",[i("v-uni-view",{staticClass:"text-primary font-weight-bold"},[t._v(t._s(t.item.user.name))]),i("v-uni-text",{staticClass:"text-muted font"},[t._v(t._s(t.item.user.sex))])],1)],1),t.item.is_top?i("v-uni-view",{staticClass:"post-tag"},[t._v("精华")]):t._e()],1),t.iscontent?t._l(t.item.content,(function(e,n){return i("v-uni-view",{key:n,staticClass:"flex flex-column p-2"},[i("v-uni-text",{staticClass:"mb-1"},[t._v(t._s(e.text))]),t._l(e.images,(function(t,e){return i("v-uni-image",{key:e,staticStyle:{"max-width":"100%"},attrs:{src:t,mode:"widthFix"}})}))],2)})):i("v-uni-view",{staticClass:"py-2",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.open.apply(void 0,arguments)}}},[i("v-uni-text",[t._v(t._s(t.item.desc.text))]),i("v-uni-view",{staticClass:"flex flex-wrap"},t._l(t.item.desc.images,(function(t,e){return i("v-uni-view",{key:e,staticClass:"flex align-center justify-center mt-1",staticStyle:{width:"33.33%"}},[i("v-uni-image",{staticClass:"rounded",staticStyle:{width:"220rpx",height:"220rpx"},attrs:{src:t,mode:"aspectFill"}})],1)})),1)],1),t.iscontent?t._e():i("v-uni-view",{staticClass:"flex align-center justify-between mt-2"},[i("v-uni-view",{staticClass:"flex align-center"},[i("v-uni-view",{staticClass:"flex align-center pr-2"},[i("v-uni-text",{staticClass:"iconfont icon-pinglun2",staticStyle:{"font-size":"23px"}}),i("v-uni-text",{staticClass:"ml-1"},[t._v(t._s(0==t.item.comment_count?"评论":t.item.comment_count))])],1),i("v-uni-view",{staticClass:"flex align-center",class:t.item.issupport?"text-danger":"",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.$emit("support",t.item.id)}}},[i("v-uni-text",{staticClass:"iconfont icon-dianzan2",staticStyle:{"font-size":"23px"}}),i("v-uni-text",{staticClass:"ml-1"},[t._v(t._s(0==t.item.support_count?"点赞":t.item.support_count))])],1),t.showDelete?i("v-uni-button",{staticClass:"ml-3",attrs:{type:"warn",size:"mini"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.$emit("delete",t.item.id)}}},[t._v("删除")]):t._e()],1),i("v-uni-text",{staticClass:"text-light-muted font"},[t._v(t._s(t.item.created_time))])],1)],2),i("v-uni-view",{staticClass:"divider"})],1)},a=[]},7392:function(t,e,i){"use strict";i.r(e);var n=i("6d57"),s=i("8a2e");for(var a in s)"default"!==a&&function(t){i.d(e,t,(function(){return s[t]}))}(a);i("af57");var o,c=i("f0c5"),r=Object(c["a"])(s["default"],n["b"],n["c"],!1,null,"589e44ca",null,!1,n["a"],o);e["default"]=r.exports},"8a2e":function(t,e,i){"use strict";i.r(e);var n=i("c81f"),s=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=s.a},"98c3":function(t,e,i){"use strict";i.r(e);var n=i("1af1"),s=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=s.a},"99cb":function(t,e,i){var n=i("24fb");e=n(!1),e.push([t.i,".post-tag[data-v-589e44ca]{padding:%?10?% %?20?%;color:#fff;background-color:#ffc107;margin-left:auto;font-size:14px!important}",""]),t.exports=e},af57:function(t,e,i){"use strict";var n=i("f652"),s=i.n(n);s.a},be40:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return n}));var n={postList:i("7392").default,commentPopup:i("9676").default},s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("post-list",{attrs:{item:t.detail,iscontent:!0}}),i("v-uni-view",{staticClass:"px-2"},[t._l(t.comments,(function(e,n){return i("v-uni-view",{key:n,staticClass:"comment-list"},[i("v-uni-image",{staticClass:"face",attrs:{src:e.user.avatar,mode:"aspectFill"}}),i("v-uni-view",{staticClass:"flex-1"},[i("v-uni-view",{staticClass:"top"},[i("v-uni-text",[t._v(t._s(e.user.name))])],1),i("v-uni-view",{staticClass:"content",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.openComment({reply_id:e.id,reply_user:e.user})}}},[t._v(t._s(e.content))]),i("v-uni-view",{staticClass:"date"},[t._v(t._s(t._f("formatTime")(e.created_time)))]),e.post_comments&&e.post_comments.length>0?i("v-uni-view",{staticClass:"bg-light px-2 mt-2"},t._l(e.post_comments,(function(n,s){return i("v-uni-view",{key:s,staticClass:"comment-list"},[i("v-uni-image",{staticClass:"face",attrs:{src:n.user.avatar,mode:"aspectFill"}}),i("v-uni-view",{staticClass:"flex-1"},[i("v-uni-view",{staticClass:"top"},[i("v-uni-text",[t._v(t._s(n.user.name))]),i("v-uni-text",[t._v("@"+t._s(n.reply_user.username))])],1),i("v-uni-view",{staticClass:"content",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.openComment({reply_id:e.id,reply_user:n.user})}}},[t._v(t._s(n.content))]),i("v-uni-view",{staticClass:"date"},[t._v(t._s(t._f("formatTime")(n.created_time)))])],1)],1)})),1):t._e()],1)],1)})),i("v-uni-button",{staticClass:"my-2",staticStyle:{width:"100%"},attrs:{type:"default",size:"mini",disabled:"more"!=t.loadStatus},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.loadMore.apply(void 0,arguments)}}},[t._v(t._s("more"==t.loadStatus?"点击加载更多":"noMore"==t.loadStatus?"没有更多了":"加载中..."))])],2),i("v-uni-view",{staticStyle:{height:"50px"}}),i("v-uni-view",{staticClass:"fixed-bottom bg-white flex align-center px-3",staticStyle:{height:"50px","z-index":"1"}},[i("v-uni-view",{staticClass:"border rounded flex-1 px-2 py-1 text-light-muted bg-light mr-2",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.openComment(!1)}}},[t._v("说一句吧")]),i("v-uni-view",{staticClass:"flex align-center",class:t.detail.issupport?"text-danger":"",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.handleSupport()}}},[i("v-uni-text",{staticClass:"iconfont icon-dianzan2",staticStyle:{"font-size":"20px"}}),i("v-uni-text",{staticClass:"ml-1"},[t._v(t._s(t.detail.support_count||"点赞"))])],1)],1),i("comment-popup",{ref:"comment",on:{send:function(e){arguments[0]=e=t.$handleEvent(e),t.sendComment.apply(void 0,arguments)}}})],1)},a=[]},c81f:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={name:"post-list",props:{item:Object,iscontent:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!1}},data:function(){return{}},methods:{open:function(){uni.navigateTo({url:"/pages/post-detail/post-detail?id="+this.item.id})}}};e.default=n},d29c:function(t,e,i){var n=i("64da");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var s=i("4f06").default;s("bcb7d1e6",n,!0,{sourceMap:!1,shadowMode:!1})},f652:function(t,e,i){var n=i("99cb");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var s=i("4f06").default;s("0c100f11",n,!0,{sourceMap:!1,shadowMode:!1})}}]);